import{w as G,a as l,v as J,p as e}from"./chunk-UH6JLGW7-DB7KfY1H.js";import{C as T,d as _,a as Z,b as ee}from"./card-CF0P5cGQ.js";import{B as g}from"./button-DQc83rjE.js";import{M as K,C as F,a as H,b as V,B as W,c as se}from"./map-pin-1iWk_dRw.js";import{b as te,o as $,m as R}from"./api-Cr5uWYEN.js";import{l as ae}from"./index-CA1CrNgP.js";import{H as le}from"./Header-C2t_h_k6.js";import{c as z}from"./createLucideIcon-DlhUvwdl.js";/**
 * @license lucide-react v0.540.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],re=z("arrow-left",ne);/**
 * @license lucide-react v0.540.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ce=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],ie=z("eye",ce);/**
 * @license lucide-react v0.540.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=[["path",{d:"M5 12h14",key:"1ays0h"}]],oe=z("minus",de);/**
 * @license lucide-react v0.540.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const me=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],xe=z("plus",me);function ue(){const[s,n]=l.useState([]),c=l.useCallback(i=>{n(a=>a.filter(m=>m.id!==i))},[]),h=l.useCallback(i=>{const a=Math.random().toString(36).slice(2);n(m=>[{id:a,message:i},...m]),setTimeout(()=>c(a),4e3)},[c]);return{toasts:s,push:h,remove:c}}function he({toasts:s,onClose:n}){return e.jsx("div",{className:"fixed top-4 right-4 z-[9999] space-y-2 w-[90vw] max-w-sm",children:s.map(c=>e.jsx("div",{className:"bg-gray-900 text-white px-4 py-3 rounded-xl shadow-lg border border-gray-700/50 cursor-pointer",onClick:()=>n(c.id),role:"status","aria-live":"polite",children:c.message},c.id))})}function X({activeOrders:s=0}){return e.jsx("header",{className:"bg-white border-b shadow-sm",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex justify-between items-center h-16",children:[e.jsx("h1",{className:"text-xl font-bold text-gray-900",children:"Restaurant Manager"}),e.jsxs(W,{variant:"secondary",className:"bg-green-100 text-green-800",children:[s," Active Orders"]})]})})})}function D({status:s}){const n=l.useMemo(()=>{const h={pending:{color:"bg-yellow-100 text-yellow-800",icon:se},preparing:{color:"bg-blue-100 text-blue-800",icon:V},ready:{color:"bg-green-100 text-green-800",icon:H},cancelled:{color:"bg-red-100 text-red-800",icon:F}};return h[s]??h.pending},[s]),c=n.icon;return e.jsxs(W,{className:`${n.color} flex items-center gap-1 px-3 py-1`,children:[e.jsx(c,{className:"w-3 h-3"}),e.jsx("span",{className:"capitalize font-medium",children:s})]})}function ge({onViewOrder:s,orders:n,setIndex:c,setOrderId:h,updateOrder:i}){return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx(X,{activeOrders:n.length}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Order Management"}),e.jsx("p",{className:"text-gray-600",children:"Manage and track all restaurant orders"})]}),n.length>0?e.jsx("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-3",children:n.map((a,m)=>e.jsxs(T,{className:"hover:shadow-lg transition-shadow duration-300 border-0 shadow-md",children:[e.jsx(Z,{className:"pb-3",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs(ee,{className:"text-lg font-bold text-gray-900",children:["Order #",a.orderNumber]}),e.jsxs("div",{className:"flex items-center gap-2 mt-2 text-sm text-gray-500",children:[e.jsx(K,{className:"w-4 h-4"}),e.jsxs("span",{children:["Table ",a.tableNumber]})]})]}),e.jsx(D,{status:a.status})]})}),e.jsxs(_,{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center py-3 border-t border-gray-100",children:[e.jsxs("p",{className:"text-2xl font-bold text-gray-900",children:["₹",a.totalAmount]}),e.jsxs("p",{className:"text-sm text-gray-500",children:[a.items.length," items"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(g,{variant:"outline",disabled:a.status==="cancelled"||a.status==="completed",onClick:()=>{i(a.id,"cancelled")},size:"sm",className:"flex-1 text-red-600 border-red-200 hover:bg-red-50",children:[e.jsx(F,{className:"w-4 h-4 mr-2"})," Cancel"]}),e.jsxs(g,{variant:"outline",disabled:a.status==="cancelled"||a.status==="completed",size:"sm",onClick:()=>{i(a.id,"completed")},className:"flex-1 text-green-600 border-green-200 hover:bg-green-50",children:[e.jsx(H,{className:"w-4 h-4 mr-2"})," Complete"]}),e.jsxs(g,{variant:"default",size:"sm",className:"flex-1 bg-blue-600 hover:bg-blue-700",onClick:()=>{s(a),c(m),h(a.id)},children:[e.jsx(ie,{className:"w-4 h-4 mr-2"})," View"]})]})]})]},a.id))}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(V,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No orders yet"}),e.jsx("p",{className:"text-gray-500",children:"Orders will appear here when customers place them."})]})]})]})}const fe=({orderId:s,isOpen:n,onClose:c,onAdded:h})=>{const[i,a]=l.useState(""),[m,w]=l.useState(1),[x,k]=l.useState(null),[M,C]=l.useState(!1),[I,S]=l.useState(!1),[o,d]=l.useState(null);l.useEffect(()=>{n||(a(""),w(1),k(null),d(null),C(!1),S(!1))},[n]);const f=async()=>{if(d(null),!i){d("Please enter an item id");return}C(!0);try{let t=null;if(typeof R.getById=="function")try{t=await R.getById(i)}catch{t=null}t||(t=(await R.getAll()).find(v=>String(v.id)===String(i)||String(v._id)===String(i))),t?k(t):(k(null),d("Item not found in menu."))}catch(t){console.error(t),d("Failed to fetch item preview.")}finally{C(!1)}},p=async()=>{if(d(null),!i){d("Enter item id.");return}if(m<1){d("Quantity must be at least 1.");return}S(!0);try{const t=x?{...x,quantity:m}:{id:Number(i),menuItemId:i,quantity:m};console.log(t),await $.addItem(s,t),h&&h(t),a(""),w(1),k(null),c()}catch(t){console.error("Failed to add item to order",t),d("Failed to add item to order.")}finally{S(!1)}};return n?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-40 p-4",children:e.jsx(T,{className:"max-w-lg w-full",children:e.jsxs(_,{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Add Item to Order"}),e.jsx("button",{onClick:c,className:"text-gray-500 hover:text-gray-700",children:"Close"})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Order ID"}),e.jsx("input",{readOnly:!0,value:s,className:"w-full p-3 border rounded bg-gray-100"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Item ID"}),e.jsx("input",{value:i,onChange:t=>a(t.target.value),placeholder:"Enter item ID"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Quantity"}),e.jsx("input",{type:"number",min:1,value:m,onChange:t=>w(Number(t.target.value)||1)})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(g,{onClick:f,disabled:M,children:M?"Loading...":"Preview"}),e.jsx(g,{onClick:p,disabled:I,children:I?"Adding...":"Add to order"}),e.jsx(g,{onClick:c,variant:"ghost",children:"Cancel"})]}),o&&e.jsx("div",{className:"text-red-500 text-sm",children:o}),x&&e.jsx("div",{className:"mt-4 bg-gray-50 p-3 rounded",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[x.image&&e.jsx("img",{src:x.image,alt:x.name,className:"w-14 h-14 object-cover rounded"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:x.name}),e.jsxs("div",{className:"text-sm",children:["₹",x.price," • ID: ",x.id??x._id??i]}),e.jsxs("div",{className:"text-sm text-gray-600",children:["Subtotal: ₹",(x.price||0)*m]})]})]})})]})]})})}):null};function pe({order:s,onBack:n,OpenModel:c,orderIndex:h,orders:i,updateOrder:a}){const[m,w]=l.useState(s.items),[x,k]=l.useState([]),[M,C]=l.useState(0);l.useEffect(()=>{w(s.items)},[s.items]);const I=l.useCallback((o,d,f)=>{if(m[f].status!=="pending")return alert("You can only update unprepared items");k(p=>{const t=p.findIndex(v=>v.id===o);let N=[...p];if(t>=0){const v=Math.max(1,N[t].quantity+d);C(r=>r+(v-N[t].quantity)*(m[f].price||0)),N[t]={...N[t],quantity:v}}else C(v=>v+d*(m[f].price||0)),N.push({id:o,quantity:(m[f].quantity||0)+d});return N})},[m]),S=async()=>{try{await $.updateItems(s.id,x),n()}catch(o){console.error("Failed to save changes:",o)}};return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx(X,{}),e.jsxs("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsxs(g,{variant:"ghost",onClick:n,className:"mb-4 text-blue-600 hover:text-blue-700 hover:bg-blue-50",children:[e.jsx(re,{className:"w-4 h-4 mr-2"})," Back to Orders"]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:["Order #",s.orderNumber]}),e.jsxs("div",{className:"flex items-center gap-4 text-gray-600",children:[e.jsx(K,{className:"w-4 h-4"}),e.jsxs("span",{children:["Table ",s.tableNumber]})]})]}),e.jsx(D,{status:s.status})]}),e.jsx("div",{className:"space-y-4 mb-8",children:i[h].items.map((o,d)=>{const f=x.find(t=>t.id===o.id),p=(f==null?void 0:f.quantity)??o.quantity;return e.jsx(T,{className:"border-0 shadow-md hover:shadow-lg transition-shadow",children:e.jsxs(_,{className:"p-6 flex flex-col sm:flex-row sm:items-center gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-bold text-gray-900 text-lg",children:o.name}),e.jsxs("p",{className:"text-gray-700",children:["₹",o.price," × ",p," ="," ",e.jsxs("span",{className:"font-semibold",children:["₹",(o.price||0)*(p||0)]})]}),e.jsx("div",{className:"mt-1",children:e.jsx(D,{status:o.status})})]}),e.jsxs("div",{className:"flex items-center gap-3 bg-gray-50 rounded-lg p-3",children:[e.jsx(g,{size:"icon",variant:"outline",onClick:()=>I(o.id,-1,d),className:"h-10 w-10 rounded-full hover:bg-red-50 hover:border-red-200",disabled:(p??1)<=1&&(s.status==="cancelled"||s.status==="completed"),children:e.jsx(oe,{className:"w-4 h-4"})}),e.jsx("span",{className:"px-4 py-2 font-bold text-lg min-w-[3rem] text-center",children:p}),e.jsx(g,{size:"icon",variant:"outline",disabled:s.status==="cancelled"||s.status==="completed",onClick:()=>I(o.id,1,d),className:"h-10 w-10 rounded-full hover:bg-green-50 hover:border-green-200",children:e.jsx(xe,{className:"w-4 h-4"})})]})]})},o.id??`${o.name}-${d}`)})}),e.jsx(T,{className:"border-0 shadow-lg",children:e.jsxs(_,{className:"p-6 flex flex-col sm:flex-row justify-between items-center gap-6",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 mb-1",children:"Total Amount"}),e.jsxs("p",{className:"text-3xl font-bold text-gray-900",children:["₹",(s.totalAmount||0)+(M||0)]})]}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsxs(g,{variant:"outline",onClick:()=>{a(s.id,"cancelled")},disabled:s.status==="cancelled"||s.status==="completed",className:"text-red-600 border-red-200 hover:bg-red-50 px-6",children:[e.jsx(F,{className:"w-4 h-4 mr-2"})," Cancel"]}),e.jsxs(g,{variant:"outline",disabled:s.status==="cancelled"||s.status==="completed",onClick:()=>{a(s.id,"completed")},className:"text-green-600 border-green-200 hover:bg-green-50 px-6",children:[e.jsx(H,{className:"w-4 h-4 mr-2"})," Complete"]}),x.length>0&&e.jsx(g,{className:"bg-blue-600 hover:bg-blue-700 px-6",onClick:S,children:"Save Changes"}),e.jsx(g,{variant:"outline",onClick:()=>{c(!0)},disabled:s.status==="cancelled"||s.status==="completed",className:"text-green-600 border-green-200 hover:bg-green-50 px-6",children:"add new item"})]})]})})]})]})}const Ie=G(function(){const[n,c]=l.useState(null),[h,i]=l.useState([]),[a,m]=l.useState(),w=l.useRef([]),x=l.useRef(null),[k,M]=l.useState(),[C,I]=l.useState(!1),S=r=>{h[a].items.push(r)},{toasts:o,push:d,remove:f}=ue(),p=te.defaults.baseURL||"http://localhost:3000";l.useEffect(()=>{$.getAll().then(r=>{i(r.data),console.log(r.data),w.current=r.data}).catch(r=>console.error("Failed to load orders:",r))},[]);const t=l.useCallback(async(r,y)=>{try{const A=(await $.getAll()).data,Y=w.current;if(i(A),w.current=A,n){const u=A.find(O=>O.id===n.id);u&&c(u)}let E=null,P=null;const B=new Map;for(const u of Y)B.set(u.id,u);for(const u of A){const O=B.get(u.id);if(O&&O.status!==u.status&&(!r||u.status===r)){E=`Order #${u.orderNumber} status is ${u.status}`;break}}if(y||!E)for(const u of A){const O=B.get(u.id);if(!O)continue;const Q=new Map;O.items.forEach((b,j)=>{const q=(b==null?void 0:b.id)??`${b==null?void 0:b.name}-${j}`;Q.set(String(q),b)});for(let b=0;b<u.items.length;b++){const j=u.items[b],q=String((j==null?void 0:j.id)??`${j==null?void 0:j.name}-${b}`),U=Q.get(q);if(U&&U.status!==j.status&&(!r||j.status===r)){P=`Order #${u.orderNumber} → "${j.name}" is ${j.status}`;break}}if(P)break}P?d(P):E&&d(E)}catch(L){console.error("Refresh after socket event failed:",L)}},[d,n]);async function N(r,y){try{$.updateStatus(r,y)}catch{}}l.useEffect(()=>{const r=ae(p,{transports:["websocket"]});return x.current=r,r.on("OrderStatus",async y=>{await t(y==null?void 0:y.status,!1)}),r.on("ItemStatus",async y=>{await t(y==null?void 0:y.status,!0)}),()=>{r.disconnect(),x.current=null}},[p,t]);const v=J();return e.jsxs(e.Fragment,{children:[e.jsx(le,{navigate:v}),e.jsx(he,{toasts:o,onClose:f}),e.jsx(fe,{orderId:k,isOpen:C,onClose:()=>I(!1),onAdded:S}),n?e.jsx(pe,{order:n,onBack:()=>c(null),OpenModel:I,updateOrder:N,orderIndex:a,orders:h}):e.jsx(ge,{onViewOrder:c,updateOrder:N,orders:h,setIndex:r=>m(r),setOrderId:M})]})});export{Ie as default};
