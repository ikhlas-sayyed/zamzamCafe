import{w as Y,a as f,v as Z,p as e}from"./chunk-UH6JLGW7-DB7KfY1H.js";import{l as ee}from"./index-CA1CrNgP.js";import{C as A,d as E,a as se}from"./card-CF0P5cGQ.js";import{B as M}from"./button-DQc83rjE.js";import{c as P,b as v,B as _,M as te,C as W,a as H}from"./map-pin-1iWk_dRw.js";import{o as q}from"./api-Cr5uWYEN.js";import{H as re}from"./header-DfiKBqCc.js";import{c as S}from"./createLucideIcon-DlhUvwdl.js";import{C as ae,a as ne}from"./chevron-up-BUQweAlY.js";/**
 * @license lucide-react v0.540.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ce=[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]],le=S("funnel",ce);/**
 * @license lucide-react v0.540.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=[["path",{d:"M11 21.73a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73z",key:"1a0edw"}],["path",{d:"M12 22V12",key:"d0xqtd"}],["polyline",{points:"3.29 7 12 12 20.71 7",key:"ousv84"}],["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}]],F=S("package",de);/**
 * @license lucide-react v0.540.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ie=[["line",{x1:"10",x2:"14",y1:"2",y2:"2",key:"14vaq8"}],["line",{x1:"12",x2:"15",y1:"14",y2:"11",key:"17fdiu"}],["circle",{cx:"12",cy:"14",r:"8",key:"1e1u0o"}]],oe=S("timer",ie);/**
 * @license lucide-react v0.540.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const me=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],xe=S("triangle-alert",me);/**
 * @license lucide-react v0.540.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const he=[["path",{d:"m16 11 2 2 4-4",key:"9rsbq5"}],["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],ue=S("user-check",he);/**
 * @license lucide-react v0.540.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pe=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],ge=S("users",pe),fe="http://localhost:3000";function y(m){return String(m)}const Ee=Y(function(){const[d,i]=f.useState([]),[h,x]=f.useState(null),[p,T]=f.useState("all"),k=f.useRef(new Set),N=f.useRef(new Set),[w,I]=f.useState(new Set),[g,O]=f.useState(new Set),U=f.useRef(null),[K,R]=f.useState([]),C=(s,t,n,r=4e3)=>{const l=`${Date.now()}-${Math.random().toString(36).slice(2,8)}`,a={id:l,title:t,message:n,type:s};R(u=>[a,...u]),setTimeout(()=>R(u=>u.filter(c=>c.id!==l)),r)};async function V(s,t){try{q.updateStatus(s,t)}catch{}}f.useEffect(()=>{let s=!0;return(async()=>{var t;try{const{data:n}=await q.getAll();if(!s)return;const r=new Set,l=new Set;n.forEach(a=>{r.add(a.id),a.items.forEach(u=>l.add(y(u.id??`${a.id}:${u.name}`)))}),k.current=r,N.current=l,I(new Set),O(new Set),i($(n,new Set,new Set)),x(((t=n[0])==null?void 0:t.id)??null)}catch(n){console.error("Failed to load orders:",n),C("error","Load failed","Unable to fetch orders")}})(),()=>{s=!1}},[]);async function B(){try{const{data:s}=await q.getAll(),t=new Set(w),n=new Set(g),r=new Map(d.map(c=>[c.id,c])),l=new Map(s.map(c=>[c.id,c])),a=[];for(const[c,o]of r.entries()){const b=l.get(c);b&&o.status!=="cancelled"&&b.status==="cancelled"&&a.push(c)}for(const c of a){t.delete(c);const o=r.get(c);o==null||o.items.forEach(b=>{const J=y(b.id??`${c}:${b.name}:${b.quantity}:${b.price}`);n.delete(J)}),C("error","Order cancelled",`Order #${(o==null?void 0:o.orderNumber)??c} was cancelled`)}s.forEach(c=>{k.current.has(c.id)||(t.add(c.id),k.current.add(c.id)),c.items.forEach(o=>{const b=y(o.id??`${c.id}:${o.name}:${o.quantity}:${o.price}`);N.current.has(b)||(n.add(b),N.current.add(b))})}),I(t),O(n);const u=s.filter(c=>c.status!=="cancelled");i($(u,t,n)),h&&a.includes(h)&&x(null)}catch(s){console.error("Failed to refresh orders:",s),C("error","Refresh failed","Unable to refresh orders")}}f.useEffect(()=>{const s=ee(fe,{transports:["websocket"]});return U.current=s,s.on("newOrder",async({order:t})=>{try{const n=y(t.id),r=new Set(w);r.add(n);const l=new Set(g);t.items.forEach(a=>{const u=y(a.id??`${t.id}:${a.name}:${a.quantity}:${a.price}`);l.add(u)}),k.current.add(n),t.items.forEach(a=>N.current.add(y(a.id??`${t.id}:${a.name}:${a.quantity}:${a.price}`))),I(r),O(l),i(a=>$([t,...Ne(a,n)],r,l)),x(n),C("success","New order",`Order #${t.orderNumber??t.id} received`)}catch(n){console.error("Failed to process newOrder:",n)}}),s.on("OrderStatus",async()=>{await B()}),s.on("ItemStatus",async()=>{await B()}),s.on("newItemAddtoOrder",async()=>{try{const{data:t}=await q.getAll(),n=new Set(w),r=new Set(g);let l=null;t.forEach(a=>{let u=!1;a.items.forEach(c=>{const o=y(c.id??`${a.id}:${c.name}:${c.quantity}:${c.price}`);N.current.has(o)||(u=!0,r.add(o),N.current.add(o))}),u&&(n.add(a.id),l=a.id)}),I(n),O(r),i($(t,n,r)),l&&x(l),l&&C("info","New items",`New items added to Order #${l}`)}catch(t){console.error("Failed to process newItemAddtoOrder:",t)}}),()=>{s.disconnect(),U.current=null}},[w,g]);const D=async(s,t,n)=>{try{i(r=>$(r.map(l=>l.id!==s?l:{...l,items:l.items.map(a=>{const u=a.id;if(u===t){const c=y(u??`${l.id}:${a.name}:${a.quantity}:${a.price}`),o=new Set(g);return o.delete(c),O(o),{...a,status:n}}return a})}),w,g)),await q.updateItemStatus(s,t,n)}catch(r){console.error(r),await B()}},Q=s=>{const t=new Set(w);t.has(s)&&(t.delete(s),I(t))},j=f.useMemo(()=>{const s=d.filter(r=>z(r,w,g)).length,t=d.filter(r=>r.status==="preparing").length,n=d.filter(r=>r.status==="ready").length;return{newCount:s,inProg:t,ready:n,totalItems:d.reduce((r,l)=>r+l.items.length,0)}},[d,w,g]),L=f.useMemo(()=>{const s=$(d,w,g);return p==="all"?s:p==="new"?s.filter(t=>z(t,w,g)):p==="in-progress"?s.filter(t=>t.status==="preparing"):p==="ready"?s.filter(t=>t.status==="ready"):s},[d,p,w,g]),X=s=>x(t=>t===s?null:s),G=Z();return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx(re,{navigate:G}),e.jsx("div",{className:"fixed top-6 right-6 z-50 flex flex-col gap-3",children:K.map(s=>e.jsx("div",{role:"alert",className:"max-w-sm w-full rounded-lg shadow-lg p-3 border flex flex-col gap-1 transition-transform transform-gpu "+(s.type==="success"?"bg-white border-green-200":s.type==="error"?"bg-white border-red-200":"bg-white border-blue-200"),children:e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"flex-1",children:[s.title&&e.jsx("div",{className:"font-semibold text-sm text-gray-900",children:s.title}),e.jsx("div",{className:"text-xs text-gray-600",children:s.message})]}),e.jsx("button",{"aria-label":"dismiss",onClick:()=>R(t=>t.filter(n=>n.id!==s.id)),className:"text-gray-400 hover:text-gray-600",children:"✕"})]})},s.id))}),e.jsxs("div",{className:"max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:[e.jsx("div",{className:"mb-8",children:e.jsx("div",{className:"border-b border-gray-200 bg-white rounded-lg shadow-sm",children:e.jsx("nav",{className:"flex space-x-8 px-6","aria-label":"Tabs",children:[{key:"all",label:"All Orders",count:d.length,icon:le},{key:"new",label:"New Orders",count:j.newCount,icon:P},{key:"in-progress",label:"In Progress",count:j.inProg,icon:v},{key:"ready",label:"Ready",count:j.ready,icon:F}].map(s=>{const t=s.icon;return e.jsxs("button",{onClick:()=>T(s.key),className:`${p===s.key?"border-blue-500 text-blue-600 bg-blue-50":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"} whitespace-nowrap py-4 px-4 border-b-2 font-medium text-sm flex items-center gap-2 transition-colors duration-200 rounded-t-lg`,children:[e.jsx(t,{className:"w-4 h-4"}),s.label,s.count>0&&e.jsx(_,{className:`ml-2 ${p===s.key?"bg-blue-100 text-blue-800":"bg-gray-100 text-gray-600"}`,children:s.count})]},s.key)})})})}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-4 gap-4 mb-8",children:[e.jsx(A,{className:"border-0 shadow-md bg-gradient-to-r from-yellow-50 to-yellow-100",children:e.jsx(E,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-yellow-800",children:"New Orders"}),e.jsx("p",{className:"text-2xl font-bold text-yellow-900",children:j.newCount})]}),e.jsx(P,{className:"w-8 h-8 text-yellow-600"})]})})}),e.jsx(A,{className:"border-0 shadow-md bg-gradient-to-r from-blue-50 to-blue-100",children:e.jsx(E,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-blue-800",children:"In Progress"}),e.jsx("p",{className:"text-2xl font-bold text-blue-900",children:j.inProg})]}),e.jsx(v,{className:"w-8 h-8 text-blue-600"})]})})}),e.jsx(A,{className:"border-0 shadow-md bg-gradient-to-r from-red-50 to-red-100",children:e.jsx(E,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-red-800",children:"Ready"}),e.jsx("p",{className:"text-2xl font-bold text-red-900",children:j.ready})]}),e.jsx(F,{className:"w-8 h-8 text-red-600"})]})})}),e.jsx(A,{className:"border-0 shadow-md bg-gradient-to-r from-green-50 to-green-100",children:e.jsx(E,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-green-800",children:"Total Items"}),e.jsx("p",{className:"text-2xl font-bold text-green-900",children:j.totalItems})]}),e.jsx(ge,{className:"w-8 h-8 text-green-600"})]})})})]}),e.jsx("div",{className:"space-y-6",children:L.length===0?e.jsx(ye,{filter:p}):L.map(s=>{var n;const t=z(s,w,g);return e.jsxs(A,{className:"shadow-lg rounded-2xl border-0 overflow-hidden hover:shadow-xl transition-shadow duration-300",children:[e.jsxs(se,{className:"flex flex-row items-center justify-between cursor-pointer bg-white hover:bg-gray-50 transition-colors duration-200 p-6",onClick:()=>{X(s.id),Q(s.id)},children:[e.jsx("div",{className:"flex items-start space-x-4",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsxs("h2",{className:"text-xl font-bold text-gray-900",children:["Order #",s.orderNumber||s.id]}),e.jsx(be,{order:s}),t&&e.jsx(_,{className:"bg-red-100 text-red-700 border-red-200 px-2 py-1 text-xs",children:"NEW"})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(te,{className:"w-4 h-4"}),e.jsxs("span",{children:["Table ",s.tableNumber??"—"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(P,{className:"w-4 h-4"}),e.jsx("span",{children:new Date(s.createdAt).toLocaleTimeString()})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ue,{className:"w-4 h-4"}),e.jsx("span",{children:((n=s.waiter)==null?void 0:n.username)??"Waiter"})]}),e.jsx("div",{className:"flex items-center gap-1",children:e.jsxs("span",{className:"font-semibold",children:["₹",s.totalAmount]})}),e.jsx("div",{className:"flex items-center gap-1",children:e.jsxs("span",{children:[s.items.length," items"]})})]})]})}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"hidden sm:flex gap-2",children:e.jsxs(M,{variant:"outline",size:"sm",className:"text-red-600 border-red-200 hover:bg-red-50",onClick:r=>{r.stopPropagation(),V(s.id,"cancelled")},children:[e.jsx(W,{className:"w-4 h-4 mr-2"}),"Cancel Order"]})}),h===s.id?e.jsx(ae,{className:"w-6 h-6 text-gray-400"}):e.jsx(ne,{className:"w-6 h-6 text-gray-400"})]})]}),h===s.id&&e.jsxs(E,{className:"bg-gray-50 p-6 space-y-4",children:[e.jsx("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center mb-4 pb-4 border-b border-gray-200",children:e.jsxs("h3",{className:"font-semibold text-gray-900 mb-2 sm:mb-0 flex items-center gap-2",children:[e.jsx(v,{className:"w-5 h-5"}),"Order Items"]})}),s.items.map(r=>{const l=y(r.id??`${s.id}:${r.name}:${r.quantity}:${r.price}`),a=g.has(l);return e.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center p-4 rounded-xl bg-white border shadow-sm gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("p",{className:"font-semibold text-gray-900 text-lg",children:r.name}),e.jsx(we,{status:r.status}),a&&e.jsx(_,{className:"bg-red-100 text-red-700 border-red-200 px-2 py-0.5 text-xs",children:"NEW"})]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Quantity: ",e.jsx("span",{className:"font-semibold",children:r.quantity})]})]}),e.jsxs("div",{className:"flex gap-2",children:[r.status==="pending"&&e.jsxs(M,{variant:"default",size:"sm",className:"bg-blue-600 hover:bg-blue-700 text-white flex items-center gap-2",onClick:()=>D(s.id,r.id,"preparing"),children:[e.jsx(v,{className:"w-4 h-4"}),"Prepare"]}),r.status==="preparing"&&e.jsxs(M,{variant:"outline",size:"sm",className:"text-red-600 border-red-200 hover:bg-red-50 flex items-center gap-2",onClick:()=>D(s.id,r.id,"ready"),children:[e.jsx(F,{className:"w-4 h-4"}),"Mark Ready"]}),r.status==="ready"&&e.jsxs(M,{variant:"outline",size:"sm",className:"text-green-600 border-green-200 cursor-not-allowed opacity-50",disabled:!0,children:[e.jsx(H,{className:"w-4 h-4"}),"Ready"]})]})]},l)}),e.jsx("div",{className:"sm:hidden flex gap-2 pt-4 border-t",children:e.jsxs(M,{variant:"outline",size:"sm",className:"flex-1 text-red-600 border-red-200 hover:bg-red-50",onClick:()=>cancelOrder(s.id),children:[e.jsx(W,{className:"w-4 h-4 mr-2"}),"Cancel Order"]})})]})]},s.id)})})]})]})});function we({status:m}){const d={pending:{cls:"bg-yellow-100 text-yellow-800 border-yellow-200",Icon:P},preparing:{cls:"bg-blue-100 text-blue-800 border-blue-200",Icon:v},ready:{cls:"bg-green-100 text-green-800 border-green-200",Icon:H}},i=d[m]??d.pending;return e.jsxs(_,{className:`${i.cls} border px-2 py-0.5 text-xs flex items-center gap-1 font-medium`,children:[e.jsx(i.Icon,{className:"w-3 h-3"}),e.jsx("span",{className:"capitalize",children:i.label??m})]})}function be({order:m}){const d={pending:{cls:"bg-yellow-100 text-yellow-800 border-yellow-200",Icon:P},preparing:{cls:"bg-blue-100 text-blue-800 border-blue-200",Icon:v,label:"In Progress"},ready:{cls:"bg-green-100 text-green-800 border-green-200",Icon:H},completed:{cls:"bg-gray-100 text-gray-700 border-gray-200",Icon:oe},cancelled:{cls:"bg-red-100 text-red-800 border-red-200",Icon:xe}},i=d[m.status]??d.pending;return e.jsxs(_,{className:`${i.cls} border px-3 py-1 text-sm flex items-center gap-1 font-medium`,children:[e.jsx(i.Icon,{className:"w-4 h-4"}),e.jsx("span",{className:"capitalize",children:i.label??m.status})]})}function ye({filter:m}){const d={all:{title:"No orders in kitchen",desc:"New orders will appear here when customers place them."},new:{title:"No new orders",desc:"New orders will appear here when customers place them."},"in-progress":{title:"No orders in progress",desc:"Orders being prepared will appear here."},ready:{title:"No ready orders",desc:"Completed orders will appear here."}};return e.jsxs("div",{className:"text-center py-12",children:[e.jsx(v,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:d[m].title}),e.jsx("p",{className:"text-gray-600",children:d[m].desc})]})}function z(m,d,i){return d.has(m.id)?!0:m.items.some(h=>{const x=y(h.id??`${m.id}:${h.name}:${h.quantity}:${h.price}`);return i.has(x)})}function $(m,d,i){const h=x=>z(x,d,i)?1:0;return[...m].sort((x,p)=>{const T=h(p)-h(x);if(T!==0)return T;const k=new Date(x.updatedAt||x.createdAt).getTime();return new Date(p.updatedAt||p.createdAt).getTime()-k})}function Ne(m,d){const i=new Set,h=[];for(const x of m)i.has(x.id)||(i.add(x.id),h.push(x));return h.sort((x,p)=>x.id===d?-1:p.id===d?1:0),h}export{Ee as default};
