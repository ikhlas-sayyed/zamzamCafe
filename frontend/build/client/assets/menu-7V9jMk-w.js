import{w as Q,a as r,v as U,p as e}from"./chunk-UH6JLGW7-DB7KfY1H.js";import{b as z,m as B,o as J}from"./api-Cr5uWYEN.js";import{C as K,M as W}from"./CurrentOrderItem-CTOLkoQ9.js";import{H as G}from"./Header-C2t_h_k6.js";import{l as V}from"./index-CA1CrNgP.js";function X(){const[l,o]=r.useState([]),n=r.useCallback(x=>{o(u=>u.filter(d=>d.id!==x))},[]),f=r.useCallback(x=>{const u=Math.random().toString(36).slice(2);o(d=>[{id:u,message:x},...d]),setTimeout(()=>n(u),4e3)},[n]);return{toasts:l,push:f,remove:n}}function Y({toasts:l,onClose:o}){return e.jsx("div",{className:"fixed top-4 right-4 z-[9999] space-y-2 w-[90vw] max-w-sm",children:l.map(n=>e.jsx("div",{className:"bg-gray-900 text-white px-4 py-3 rounded-xl shadow-lg border border-gray-700/50 cursor-pointer",onClick:()=>o(n.id),role:"status","aria-live":"polite",children:n.message},n.id))})}const Z=()=>{const[l,o]=r.useState([]),[n,f]=r.useState(),[x,u]=r.useState({}),[d,k]=r.useState(),[g,y]=r.useState("menu"),[b,M]=r.useState(),[I,E]=r.useState(1),[i,j]=r.useState([]),[T,w]=r.useState(!1),$=r.useRef(null),C=z.defaults.baseURL||"http://localhost:3000",{toasts:R,push:m,remove:A}=X();r.useEffect(()=>{(async()=>{try{const s=await B.getAll();o(s);const h=JSON.parse(localStorage.getItem("user"));f(h.id)}catch(s){console.error("Failed to load menu:",s)}})()},[]),r.useEffect(()=>{n!==void 0&&console.log(n)},[n]),r.useEffect(()=>{const t=V(C,{transports:["websocket"]});return $.current=t,t.on("OrderStatus",s=>{s.waiterId===n&&m(`Order #${s.orderNumber} is ${s.status}`)}),t.on("ItemStatus",s=>{s.waiterId===n&&m(`Order #${s.orderNumber} - ${s.name} is ${s.status}`)}),()=>{t.disconnect()}},[C,n,m]);const S=r.useCallback((t,s,h,N,L)=>{j(v=>{const p=v.findIndex(c=>c.menuItemId===t);if(p!==-1){const c=[...v];return c[p]={...c[p],quantity:c[p].quantity+s},c}else return[...v,{menuItemId:t,quantity:s,name:h,price:N,image:L}]})},[]),a=r.useMemo(()=>b?l.find(t=>t.id===Number(b))??null:null,[l,b]),q=r.useMemo(()=>i.reduce((t,s)=>t+(s.price??0)*s.quantity,0),[i]),D=t=>{M(Number(t))},F=()=>{a&&S(a.id,I,a.name,a.price,a.image)},P=t=>{j(s=>s.filter((h,N)=>N!==t))},O=()=>{j([])},_=async()=>{w(!0),console.log(i);try{await J.create({items:i,tableNumber:d,notes:""}),O(),m("Order placed!")}catch(t){console.error("Failed to place order:",t),m("Error placing order")}finally{w(!1)}},H=U();return e.jsxs(e.Fragment,{children:[e.jsx(G,{navigate:H}),e.jsx(Y,{toasts:R,onClose:A}),e.jsx("div",{className:"container mx-auto px-4 py-6",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg p-6 mb-6",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-800 mb-4",children:"Create New Order"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Table Number"}),e.jsx("input",{type:"number",value:d??"",onChange:t=>k(parseInt(t.target.value)),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Table #"})]})}),e.jsxs("div",{className:"flex space-x-4 mb-6",children:[e.jsx("button",{onClick:()=>y("menu"),className:`px-6 py-3 rounded-lg font-medium transition-all duration-300 ${g==="menu"?"bg-blue-500 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:"Menu Selection"}),e.jsx("button",{onClick:()=>y("id"),className:`px-6 py-3 rounded-lg font-medium transition-all duration-300 ${g==="id"?"bg-blue-500 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:"ID Entry"})]}),g==="id"&&e.jsxs("div",{className:"bg-gray-50 rounded-lg p-6 mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Enter Item by ID"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Item ID"}),e.jsx("input",{type:"number",value:b??"",onChange:t=>D(t.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter ID (1-12)"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Quantity"}),e.jsx("input",{type:"number",min:"1",value:I,onChange:t=>E(parseInt(t.target.value)||1),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsx("div",{className:"flex items-end",children:e.jsx("button",{onClick:F,className:"w-full bg-blue-500 text-white py-3 rounded-lg font-medium hover:bg-blue-600 transition-colors",children:"Add Item"})})]}),a&&e.jsx("div",{className:"mt-4",children:e.jsxs("div",{className:"bg-white border rounded-lg p-3 flex items-center space-x-3",children:[e.jsx("img",{src:a.image,alt:a.name,className:"w-16 h-16 object-cover rounded"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold",children:a.name}),e.jsxs("p",{className:"text-blue-600 font-bold",children:["₹",a.price]})]})]})})]}),i.length>0&&e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg p-6 mb-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-800",children:"Current Order"}),e.jsx("button",{onClick:O,className:"text-red-500 hover:text-red-700 font-medium",children:"Clear All"})]}),e.jsx("div",{className:"space-y-3",children:i.map((t,s)=>e.jsx(K,{item:t,index:s,onRemove:P},t.menuItemId))}),e.jsxs("div",{className:"border-t pt-4 mt-4",children:[e.jsxs("div",{className:"flex justify-between items-center text-xl font-bold",children:[e.jsx("span",{children:"Total"}),e.jsxs("span",{children:["₹",q]})]}),e.jsx("button",{onClick:_,disabled:T,className:"w-full mt-4 bg-green-500 text-white py-3 rounded-lg font-semibold hover:bg-green-600 transition-colors",children:"Submit Order"})]})]}),g==="menu"&&e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 mb-6",children:l.map(t=>e.jsx(W,{item:t,additems:S},t.id))})]})})]})},ae=Q(Z);export{ae as default};
