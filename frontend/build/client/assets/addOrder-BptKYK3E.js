import{w as Q,a as r,v as z,p as e}from"./chunk-UH6JLGW7-DB7KfY1H.js";import{H as B}from"./Header-DfIEmK8s.js";import{b as M,m as J,o as K}from"./api-CIihbRwE.js";import{C as W,M as G}from"./CurrentOrderItem-7r13Y-bP.js";import{l as V}from"./index-CA1CrNgP.js";import"./createLucideIcon-DlhUvwdl.js";function X(){const[l,o]=r.useState([]),a=r.useCallback(b=>{o(u=>u.filter(d=>d.id!==b))},[]),f=r.useCallback(b=>{const u=Math.random().toString(36).slice(2);o(d=>[{id:u,message:b},...d]),setTimeout(()=>a(u),4e3)},[a]);return{toasts:l,push:f,remove:a}}function Y({toasts:l,onClose:o}){return e.jsx("div",{className:"fixed top-4 right-4 z-[9999] space-y-2 w-[90vw] max-w-sm",children:l.map(a=>e.jsx("div",{className:"bg-gray-900 text-white px-4 py-3 rounded-xl shadow-lg border border-gray-700/50 cursor-pointer",onClick:()=>o(a.id),role:"status","aria-live":"polite",children:a.message},a.id))})}const Z=()=>{const[l,o]=r.useState([]),[a,f]=r.useState(),[b,u]=r.useState({}),[d,E]=r.useState(),[g,I]=r.useState("menu"),[x,T]=r.useState(),[w,R]=r.useState(1),[i,j]=r.useState([]),[N,C]=r.useState(!1),$=r.useRef(null),S=M.defaults.baseURL||"http://localhost:3000",{toasts:A,push:m,remove:q}=X();r.useEffect(()=>{(async()=>{try{const s=await J.getAll();o(s);const h=JSON.parse(localStorage.getItem("user"));f(h.itemNumber)}catch(s){console.error("Failed to load menu:",s)}})()},[]),r.useEffect(()=>{a!==void 0&&console.log(a)},[a]),r.useEffect(()=>{const t=V(S,{transports:["websocket"]});return $.current=t,t.on("OrderStatus",s=>{s.waiterId===a&&m(`Order #${s.orderNumber} is ${s.status}`)}),t.on("ItemStatus",s=>{s.waiterId===a&&m(`Order #${s.orderNumber} - ${s.name} is ${s.status}`)}),()=>{t.disconnect()}},[S,a,m]);const O=r.useCallback((t,s,h,v,H)=>{j(y=>{const p=y.findIndex(c=>c.menuItemId===t);if(p!==-1){const c=[...y];return c[p]={...c[p],quantity:c[p].quantity+s},c}else return[...y,{menuItemId:t,quantity:s,name:h,price:v,image:H}]})},[]),n=r.useMemo(()=>x?l.find(t=>t.itemNumber===Number(x))??null:null,[l,x]),D=r.useMemo(()=>i.reduce((t,s)=>t+(s.price??0)*s.quantity,0),[i]),F=t=>{T(Number(t))},P=()=>{n&&O(n.id,w,n.name,n.price,n.image)},L=t=>{j(s=>s.filter((h,v)=>v!==t))},k=()=>{j([])},U=async()=>{C(!0),console.log(i);try{await K.create({items:i,tableNumber:d,notes:""}),k(),m("Order placed!")}catch(t){console.error("Failed to place order:",t),m("Error placing order")}finally{C(!1)}},_=z();return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"min-h-screen flex bg-gray-100",children:[e.jsx(B,{navigate:_}),e.jsx(Y,{toasts:A,onClose:q}),e.jsx("div",{className:"container mx-auto px-4 py-6",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg p-6 mb-6",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-800 mb-4",children:"Create New Order"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Table Number"}),e.jsx("input",{type:"number",value:d??"",onChange:t=>E(parseInt(t.target.value)),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Table #"})]})}),e.jsxs("div",{className:"flex space-x-4 mb-6",children:[e.jsx("button",{onClick:()=>I("menu"),className:`px-6 py-3 rounded-lg font-medium transition-all duration-300 ${g==="menu"?"bg-blue-500 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:"Menu Selection"}),e.jsx("button",{onClick:()=>I("id"),className:`px-6 py-3 rounded-lg font-medium transition-all duration-300 ${g==="id"?"bg-blue-500 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:"ID Entry"})]}),g==="id"&&e.jsxs("div",{className:"bg-gray-50 rounded-lg p-6 mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Enter Item by ID"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Item ID"}),e.jsx("input",{type:"number",value:x??"",onChange:t=>F(t.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter ID (1-12)"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Quantity"}),e.jsx("input",{type:"number",min:"1",value:w,onChange:t=>R(parseInt(t.target.value)||1),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsx("div",{className:"flex items-end",children:e.jsx("button",{onClick:P,className:"w-full bg-blue-500 text-white py-3 rounded-lg font-medium hover:bg-blue-600 transition-colors",children:"Add Item"})})]}),n&&e.jsx("div",{className:"mt-4",children:e.jsxs("div",{className:"bg-white border rounded-lg p-3 flex items-center space-x-3",children:[e.jsx("img",{src:M.defaults.baseURL+n.image,crossOrigin:"anonymous",alt:n.name,className:"w-16 h-16 object-cover rounded"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold",children:n.name}),e.jsxs("p",{className:"text-blue-600 font-bold",children:["₹",n.price]})]})]})})]}),i.length>0&&e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg p-6 mb-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-800",children:"Current Order"}),e.jsx("button",{onClick:k,disabled:N,className:"text-red-500 hover:text-red-700 font-medium",children:"Clear All"})]}),e.jsx("div",{className:"space-y-3",children:i.map((t,s)=>e.jsx(W,{item:t,index:s,onRemove:L},t.menuItemId))}),e.jsxs("div",{className:"border-t pt-4 mt-4",children:[e.jsxs("div",{className:"flex justify-between items-center text-xl font-bold",children:[e.jsx("span",{children:"Total"}),e.jsxs("span",{children:["₹",D]})]}),e.jsx("button",{onClick:U,disabled:N,className:"w-full mt-4 bg-green-500 text-white py-3 rounded-lg font-semibold hover:bg-green-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:N?"Submitting.. Order":"Submit Order"})]})]}),g==="menu"&&e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 mb-6",children:l.map(t=>e.jsx(G,{item:t,additems:O},t.id))})]})})]})})},le=Q(Z);export{le as default};
