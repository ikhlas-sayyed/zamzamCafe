import{R as I}from"./chunk-UH6JLGW7-DB7KfY1H.js";const O=t=>{let o;const e=new Set,s=(i,h)=>{const g=typeof i=="function"?i(o):i;if(!Object.is(g,o)){const S=o;o=h??(typeof g!="object"||g===null)?g:Object.assign({},o,g),e.forEach(d=>d(o,S))}},a=()=>o,c={setState:s,getState:a,getInitialState:()=>m,subscribe:i=>(e.add(i),()=>e.delete(i))},m=o=t(s,a,c);return c},A=(t=>t?O(t):O),H=t=>t;function R(t,o=H){const e=I.useSyncExternalStore(t.subscribe,I.useCallback(()=>o(t.getState()),[t,o]),I.useCallback(()=>o(t.getInitialState()),[t,o]));return I.useDebugValue(e),e}const j=t=>{const o=A(t),e=s=>R(o,s);return Object.assign(e,o),e},J=(t=>j);function N(t,o){let e;try{e=t()}catch{return}return{getItem:a=>{var r;const f=m=>m===null?null:JSON.parse(m,void 0),c=(r=e.getItem(a))!=null?r:null;return c instanceof Promise?c.then(f):f(c)},setItem:(a,r)=>e.setItem(a,JSON.stringify(r,void 0)),removeItem:a=>e.removeItem(a)}}const p=t=>o=>{try{const e=t(o);return e instanceof Promise?e:{then(s){return p(s)(e)},catch(s){return this}}}catch(e){return{then(s){return this},catch(s){return p(s)(e)}}}},w=(t,o)=>(e,s,a)=>{let r={storage:N(()=>localStorage),partialize:n=>n,version:0,merge:(n,v)=>({...v,...n}),...o},f=!1;const c=new Set,m=new Set;let i=r.storage;if(!i)return t((...n)=>{console.warn(`[zustand persist middleware] Unable to update item '${r.name}', the given storage is currently unavailable.`),e(...n)},s,a);const h=()=>{const n=r.partialize({...s()});return i.setItem(r.name,{state:n,version:r.version})},g=a.setState;a.setState=(n,v)=>(g(n,v),h());const S=t((...n)=>(e(...n),h()),s,a);a.getInitialState=()=>S;let d;const k=()=>{var n,v;if(!i)return;f=!1,c.forEach(u=>{var l;return u((l=s())!=null?l:S)});const y=((v=r.onRehydrateStorage)==null?void 0:v.call(r,(n=s())!=null?n:S))||void 0;return p(i.getItem.bind(i))(r.name).then(u=>{if(u)if(typeof u.version=="number"&&u.version!==r.version){if(r.migrate){const l=r.migrate(u.state,u.version);return l instanceof Promise?l.then(b=>[!0,b]):[!0,l]}console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,u.state];return[!1,void 0]}).then(u=>{var l;const[b,_]=u;if(d=r.merge(_,(l=s())!=null?l:S),e(d,!0),b)return h()}).then(()=>{y==null||y(d,void 0),d=s(),f=!0,m.forEach(u=>u(d))}).catch(u=>{y==null||y(void 0,u)})};return a.persist={setOptions:n=>{r={...r,...n},n.storage&&(i=n.storage)},clearStorage:()=>{i==null||i.removeItem(r.name)},getOptions:()=>r,rehydrate:()=>k(),hasHydrated:()=>f,onHydrate:n=>(c.add(n),()=>{c.delete(n)}),onFinishHydration:n=>(m.add(n),()=>{m.delete(n)})},r.skipHydration||k(),d||S},E=w,C=J()(E((t,o)=>({user:null,token:null,isAuthenticated:!1,login:(e,s)=>{t({user:e,token:s,isAuthenticated:!0}),localStorage.setItem("token",s),localStorage.setItem("user",JSON.stringify(e))},logout:()=>{t({user:null,token:null,isAuthenticated:!1}),localStorage.removeItem("token"),localStorage.removeItem("user")},updateUser:e=>{t({user:e}),localStorage.setItem("user",JSON.stringify(e))}}),{name:"auth-storage",partialize:t=>({user:t.user,token:t.token,isAuthenticated:t.isAuthenticated})}));export{C as u};
